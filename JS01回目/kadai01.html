<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <script src="js/jquery-2.1.3.min.js"></script>
  <link rel="stylesheet" href="css/sample.css">
  <title>じゃんけん</title>
</head>
<body>

<header>
  <p class="pattern">じゃんけんで怪獣をやっつけろ！</p>
</header>

<main>
  <div class="action_wrapper">
    <div class="battle_wrapper">
      <div class="flex_wrapper1">
        <div class="life" id="player_l">
          <img src="img/heart.png" alt="" class="heart">
          <img src="img/heart.png" alt="" class="heart">
          <img src="img/heart.png" alt="" class="heart">
          <img src="img/heart.png" alt="" class="heart">
          <img src="img/heart.png" alt="" class="heart">
          <img src="img/heart.png" alt="" class="heart">
        </div>
          <img src="img/ranger_red.png" alt="" class="big swing" id="hero">
          <img src="img/mark_question.png" alt="" id="player_q">
          <img src="img/janken_gu.png" alt="" id="player_g">
          <img src="img/janken_choki.png" alt="" id="player_c">
          <img src="img/janken_pa.png" alt="" id="player_p">
          <img src="img/vs.png" alt="" id="">
          <img src="img/mark_question.png" alt="" id="com_q">
          <img src="img/cp_gu.png" alt="" id="com_g">
          <img src="img/cp_choki.png" alt="" id="com_c">
          <img src="img/cp_pa.png" alt="" id="com_p">
          <img src="img/kaiju_brown.png" alt="" class="big swing" id="com">
        <div class="life" id="com_l">
          <img src="img/heart.png" alt="" class="heart">
          <img src="img/heart.png" alt="" class="heart">
          <img src="img/heart.png" alt="" class="heart">
          <img src="img/heart.png" alt="" class="heart">
          <img src="img/heart.png" alt="" class="heart">
          <img src="img/heart.png" alt="" class="heart">
        </div>
      </div>
    </div>
    <div class="result_wrapper">
      <div class="flex_wrapper2">
        <img src="img/ouen1.png" alt="" id="ouen_1" class="jump1">
        <img src="img/ouen2.png" alt="" id="ouen_2" class="jump2">
        <img src="img/ouen3.png" alt="" id="ouen_3" class="jump2">
        <img src="img/ouen4.png" alt="" id="ouen_4" class="jump1">
        <img src="img/pose_win_girl.png" alt="" id="win_b">
        <img src="img/pose_win_boy.png" alt="" id="win_g">
        <img src="img/pose_lose_boy.png" alt="" id="lose_b">
        <img src="img/pose_lose_girl.png" alt="" id="lose_g">
        <img src="img/ac_d.png" alt="" id="ac_d">
        <img src="img/ac_r.png" alt="" id="ac_r">
        <img src="img/ac_a.png" alt="" id="ac_a">
        <img src="img/ac_w.png" alt="" id="ac_w">
        <div id="restart"><img src="img/restart.png" alt=""></div>
        <div id="reset"><img src="img/reset.png" alt=""></div>
      </div>
    </div>
  </div>
  <div class="choice_area">
    <div id="h_change"><img src="img/gear4.png" alt=""></div>
    <div class="choice_wrapper choice_wrapper_st" id="pull">
      <p id="start">スタート</p>
      <div id="gu_btn">
        <img src="img/janken_gu.png" alt="">
      </div>
      <div id="cho_btn">
        <img src="img/janken_choki.png" alt="">
      </div>
      <div id="par_btn">
        <img src="img/janken_pa.png" alt="">
      </div>
    </div>
    <div id="k_change"><img src="img/gear5.png" alt=""></div>
  </div>
  <div><p id="comment"></p></div>
  <div class="stats_wrapper">
    <table class="history" id="history_t">
      <tr>
        <th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
      </tr>
      <tr>
        <th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
      </tr>
      <tr>
        <th><img src="img/ranger_red.png" id="history_h"></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
      </tr>
      <tr>
        <th><img src="img/kaiju_brown.png" id="history_k"></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
      </tr>
    </table>
    <span id="log"></span>

  <!-- トロフィー置き場 -->
  <div class="trophy_wrapper">
    <div id="tro_13" class="trophy" style="order:1" ><img src="img/worldcup.png" alt=""><p id="tro_title">黒ボス討伐！</p></div>
    <div id="tro_12" class="trophy" style="order:2"><img src="img/gold.png" alt=""><p id="tro_title">赤怪獣討伐！</p></div>
    <div id="tro_11" class="trophy" style="order:3"><img src="img/silver.png" alt=""><p id="tro_title">青怪獣討伐！</p></div>
    <div id="tro_10" class="trophy" style="order:4"><img src="img/bronze.png" alt=""><p id="tro_title">ザコ討伐！</p></div>
    <div id="tro_7" class="trophy" style="order:8"><img src="img/crown10.png" alt=""><p id="tro_title">７連勝</p></div>
    <div id="tro_6" class="trophy" style="order:9"><img src="img/crown8.png" alt=""><p id="tro_title">６連勝</p></div>
    <div id="tro_5" class="trophy" style="order:10"><img src="img/crown7.png" alt=""><p id="tro_title">５連勝</p></div>
    <div id="tro_4" class="trophy" style="order:11"><img src="img/crown4.png" alt=""><p id="tro_title">４連勝</p></div>
    <div id="tro_3" class="trophy" style="order:12"><img src="img/crown5.png" alt=""><p id="tro_title">３連勝</p></div>
  </div>
</main>

<footer></footer>

<script>

//グローバル変数宣言
// let count = 0; //試行回数をカウント *LocalStrageに保存*
let maxhp = 6; //最大ＨＰ
let player_hp = maxhp;
let com_hp = maxhp;
var hc = 0; //ヒーロー交代用（0-4：5種類）
var kc = 0; //怪獣変更用（0-3：4種類）

//動作確認用
let aaa = "変数宣言"; 
let bbb = "ヒーロー交代";
let ccc = "怪獣変更";
let ddd = "スタートクリック";
let eee = "ハート設定";
let fff = "自分の手を選択";
let jjj = "トロフィー連勝フラグ";
let zzz = "トロフィー表示継続";
console.log(aaa);

// let wins_count = 0; //連勝カウント *LocalStrageに保存*
// let maxwins = 2;  //最大連勝数 *LocalStrageに保存*
// let wins = [1,1,1,0,0,0,0,0,0,0,0]; //連勝フラグ（3連勝以上未成立） *LocalStrageに保存*
// let beat = [0,0,0,0]; //クリアフラグ *LocalStrageに保存*

// var g_results = []; //全ての手と結果を保存  *LocalStrageに保存*

//LocalStrageに保存しているデータを取得 無駄に長い記述、、、もっと良い方法絶対あるよね
let count = ""; //localdataを受け取る空の変数宣言
if(!localStorage.getItem('count')) {count = 0; //データがない場合
} else {count = Number(localStorage.getItem('count'));} //データがある場合、数値として変数countに入力
let wins_count = ""; 
if(!localStorage.getItem('wins_count')) {wins_count = 0;
} else {wins_count = Number(localStorage.getItem('wins_count')); }
let maxwins = ""; 
if(!localStorage.getItem('maxwins')) {maxwins = 0;
} else {maxwins = Number(localStorage.getItem('maxwins'));}
let g_results = {};
if(!localStorage.getItem('g_results')) {g_results = []; 
} else {g_results = JSON.parse(localStorage.getItem('g_results'));} //データがある場合、変数をJSON形式で入力
let wins = {};
if(!localStorage.getItem('wins')) {wins = [1,1,1,0,0,0,0,0,0,0,0]; 
} else {wins = JSON.parse(localStorage.getItem('wins'));}
let beat = {};
if(!localStorage.getItem('beat')) {beat = [0,0,0,0]; 
} else {beat = JSON.parse(localStorage.getItem('beat'));}

//LocalStrageに保存しているデータを消去 消去するデータを指定
// function Deletels(){
//   localStorage.removeItem("count, g_results, wins_count, maxwins, wins, beat"); //localstrageのデータを消去
//   console.log(localStorage.length); //確認
// }

//結果保存用のファンクション
function Results(a,b,c,d){
  this.gamecount = a;
  this.player_p = b;
  this.com_r = c;
  this.player_result = d;
}

//３連勝以上した場合の追加英語コメント
let engcomment= ["Great!","Brilliant!!","Wonderful!!!","Amazing!!!!","Excellent!!!!!","Fantastic!!!!!!","Awesome!!!!!!!"]

//ヒーロー交代
var heroes = ["img/ranger_red.png","img/ranger_blue.png","img/ranger_green.png","img/ranger_pink.png","img/ranger_yellow.png"];
let hccomment = ["レッド：リーダー・熱血漢・最強・行動派･成長株","ブルー：ライバル・ナルシスト・沈着冷静・知性派","グリーン：最年少・ひねくれ者・努力家･メカに強い",
"ピンク：トラブルメーカー・お調子者・アイドル的存在","イエロー：ムードメーカー・お人好し・力自慢･猪突猛進"];//コメント
$("#h_change").on("click",function(){
  console.log(bbb);
  if(hc<heroes.length-1){
    hc++;
    $("#hero").attr("src",heroes[hc]);
    $("#history_h").attr("src",heroes[hc]);
    document.getElementById('comment').innerHTML = hccomment[hc];
  }else{
    hc=0;
    $("#hero").attr("src",heroes[hc]);
    $("#history_h").attr("src",heroes[hc]);
    document.getElementById('comment').innerHTML = hccomment[hc];
  }
});
$("#h_change").hover(function() { //ホバーでコメント表示
  document.getElementById('comment').innerHTML = "ヒーローチェンジ　ヒーローごとに能力の差をつける余裕はなかったんだ";
});

//怪獣変更
var coms = ["img/kaiju_brown.png","img/kaiju_blue.png","img/kaiju_red.png","img/kaiju_black.png"];
let kccomment = ["ザコ怪獣：隠し事が嫌いで飾り気がなく誰とでもオープンに接する","青怪獣：調和を求めて他人を第一に考え冷静で汚れがなく几帳面で理性的",
"赤怪獣：リスクを恐れずエクストリームスポーツを楽しんだりしている","黒ボス：内向的でまわりが考えるより傷つきやすい一面を持っている"];
$("#k_change").on("click",function(){
  console.log(ccc);
  if(kc<coms.length-1){
    kc++;
    $("#com").attr("src",coms[kc]);
    $("#history_k").attr("src",coms[kc]);
    document.getElementById('comment').innerHTML = kccomment[kc];
  }else{
    kc=0;
    $("#com").attr("src",coms[kc]);}
    $("#history_k").attr("src",coms[kc]);
    document.getElementById('comment').innerHTML = kccomment[kc];
});
$("#k_change").hover(function() { //ホバーでコメント表示
  document.getElementById('comment').innerHTML = "怪獣チェンジ　色で強さが違うぞ　弱い 茶＜青＜赤＜黒 強い";
});

//歯車をクリックしてから一定時間回転アニメーションを継続
var $touch = $("#h_change img");
$touch.click(function() {
  $touch.addClass('active');
  setTimeout(function() { //setTime
  $touch.removeClass('active');
  }, 1000);
});
var $touchk = $("#k_change img");
$touchk.click(function() {
  $touchk.addClass('active');
  setTimeout(function() {
  $touchk.removeClass('active');
  }, 1000);
});

console.log(zzz);
console.log(count);
console.log(beat.length);

//２週目以降の場合はヒストリーとトロフィーの表示を継続
if(count!=0){ //怪獣討伐トロフィー解除
  for(j=3;j<=maxwins;j++){
    $("#tro_"+j).css({'display': "inline"});
  }
  for(k=0;k<beat.length;k++){
    if(beat[k]){
      $("#tro_1"+k).css({'display': "inline"});
    }
  }
}

  //スタートボタンをクリックして開始
$("#start").on("click",function(){
  console.log(ddd);
  $("#pull").removeClass("choice_wrapper_st");
  $("#start,#h_change,#k_change").css("display","none");
  $("#gu_btn>img,#cho_btn>img,#par_btn>img,#history_h,#history_k").css("display","inline");
  $(".life,#player_q,#com_q").css("opacity","1");
  document.getElementById('comment').innerHTML = "";
  
//怪獣の種類によってHPとハートimgを増加
  com_hp += kc;
  if(com_hp<maxhp){
    com_hp += maxhp - com_hp;
  }
  for(k=0;k<kc;k++){
    console.log(eee);
    var img = document.createElement('img'); // img要素を生成
    img.src = 'img/heart.png'; // 画像パスを追加
    img.className = 'heart'; // classを追加
    document.getElementById('com_l').appendChild(img); // 生成したimg要素を追加する
  }
}); 

//自分の手を選択
  $("#pull div").on("click",function(){ 
  console.log(fff);
  count += 1;//ゲーム回数
  console.log(count);

//クリックするたびにロボットの？・グーチョキパーimg・結果を全て消去
  $("#player_q,#player_g,#player_c,#player_p").css("display","none"); 
  $("#com_q,#com_g,#com_c,#com_p").css("display","none");
  $("#ouen_1,#ouen_2,#ouen_3,#ouen_4,#win_b,#win_g,#lose_b,#lose_g,#ac_d,#ac_r,#ac_a,#ac_w").css("display","none"); 
  document.getElementById('comment').innerHTML = "";

//プレイヤーの選んだ手 p
  var p = $(this).index(); 

  if(p==1){
    $("#player_hands").html("グー");
    $("#player_g").css("display","inline");
  }else if(p==2){
    $("#player_hands").html("チョキ");
    $("#player_c").css("display","inline");
  }else if(p==3){
    $("#player_hands").html("パー");
    $("#player_p").css("display","inline");
  }else{
    $("#player_hands").html("エラー");
  }

//ロボットの手 r
  const s = Math.random()*3; //小数点0.x～0.999999.....*3
  // const r = Math.ceil(s);
  const r = 1;

  if(r==1){
    $("#comhands").html("グー");
    $("#com_g").css("display","inline");
  }else if(r==2){
    $("#com_hands").html("チョキ");
    $("#com_c").css("display","inline");
  }else if(r==3){
    $("#com_hands").html("パー");
    $("#com_p").css("display","inline");
  }else{
    $("#com_hands").html("エラー");
  }

//結果をresultに保存
  let result;
  if((p==1 && r==1)||(p==2 && r==2)||(p==3 && r==3)){
    $("#judgment").html("あいこ");
    $(".result_wrapper").css({'background-color': "white"});
    result = "draw";
  }else if((p==1 && r==2)||(p==2 && r==3)||(p==3 && r==1)){
    $("#judgment").html("あなたの勝ち！");
    $(".result_wrapper").css({'background-color': "yellow"});
    result = "win";
    com_hp -= 1;
    wins_count += 1;
  }else if((p==1 && r==3)||(p==2 && r==1)||(p==3 && r==2)){
    $("#judgment").html("あなたの負け");
    $(".result_wrapper").css({'background-color': "red"});
    result = "lose";
    player_hp -= 1;
    wins_count = 0;
  }else{
    $("#judgment").html("エラー");
  }

//ハートの残数にあわせてimgを１つずつ非表示
  $("#player_l .heart").eq(player_hp).addClass("erase");
  $("#com_l .heart").eq(com_hp).addClass("erase");

//resultによって結果imgを表示
//どちらかのハートの数がゼロになったら終了
  if(result == "win"){
    $("#win_b,#win_g").css("display","inline"); //じゃんけん結果のimg表示
    if(com_hp == 0){
      $("#hero").addClass("jump");
      $("#com").addClass("falldown");
      $("#win_b,#win_g").css("height","300px"); //拡大表示  
      $("#win_b,#win_g").css("background","yellow");
      $("#tro_1"+kc).css({'display': "inline"});//怪獣討伐トロフィー解除
      beat[kc] = 1;
      $("#gu_btn,#cho_btn,#par_btn").addClass("hide"); //非表示
      $(".choice_wrapper").css({'background': "transparent"}); //非表示
      $(".result_wrapper").css({'background-color': "transparent"}); //非表示
      $("#restart,#reset").css({'display': "inline"}); //表示
      $("#restart,#reset").css({'opacity': "0"}); //透明化
      $("#restart,#reset").addClass("fadein"); //透明化を解除して表示したまま
      $("#restart,#reset").click(function() {location.reload();}); //画像をクリックでリロードしてリスタート
      $("#reset").click(function(){localStorage.clear();}); //画像をクリックで実績をクリア localstrageのデータ全てを消去
    }
  }else if(result == "lose"){
    $("#lose_b,#lose_g").css("display","inline");
    if(player_hp == 0){
      $("#com").addClass("jump");
      $("#hero").addClass("erase2");
      $("#lose_b,#lose_g").css("height","300px");
      $("#lose_b,#lose_g").css("background","black");
      $("#gu_btn,#cho_btn,#par_btn").addClass("hide");
      $(".choice_wrapper").css({'background': "transparent"});
      $(".result_wrapper").css({'background-color': "transparent"});
      $("#restart,#reset").css({'display': "inline"}); //表示
      $("#restart,#reset").css({'opacity': "0"}); //透明化
      $("#restart,#reset").addClass("fadein"); //透明化を解除して表示したまま
      $("#restart,#reset").click(function() {location.reload();}); //画像をクリックでリロードしてリスタート
      $("#reset").click(function(){localStorage.clear();}); //画像をクリックで実績をクリア localstrageのデータ全てを消去
    }
  }else if(result == "draw"){
    $("#ac_d,#ac_r,#ac_a,#ac_w").css("display","inline");
  }
$("#restart").hover(function() { //ホバーでコメント表示
  document.getElementById('comment').innerHTML = "リスタート　実績トロフィーはそのまま";
});
$("#reset").hover(function() { //ホバーでコメント表示
  document.getElementById('comment').innerHTML = "リセット　実績トロフィーは初期状態に戻るよ";
});


//コメント表示
  if(wins_count>=2){
    document.getElementById('comment').innerHTML = wins_count +' 連勝！';
    if(wins_count>3){
      $('#comment').append(engcomment[wins_count-4]);
    }
  }

//トロフィー用連勝フラグを立てる
  if(wins_count>maxwins){ //連勝記録を更新した時だけ実行
    console.log(jjj);
    maxwins++;
    wins[maxwins] = 1;
    console.log(maxwins);
    if(maxwins<=7){
      $("#tro_"+maxwins).css({'display': "inline"});
    }
  }
  console.log(maxwins);
  console.log(wins);
  console.log(beat);

//オブジェクトを配列に記録
  g_results[count] = new Results(count,p,r,result);

//オブジェクトの内容をテーブルに入力 *リスタート後に実行*
  var table = document.getElementById("history_t");//テーブルの内容を全て取り込んで書き換え
  for(let i=1;i<=count;i++){
    if(i>10){//直近10回の結果だけを表示
      break;
    }else{
      table.rows[0].cells[i].innerText = count-i+1;   
      table.rows[1].cells[i].innerText = g_results[count-i+1]["player_result"];
      table.rows[2].cells[i].innerText = g_results[count-i+1]["player_p"];
      table.rows[3].cells[i].innerText = g_results[count-i+1]["com_r"];
    }
  }
  //tableの入力内容によって結果imgを表示
  for(i=1;i<11;i++){
    if(table.rows[1].cells[i].innerText == "WIN"){
      $(table.rows[1].cells[i]).css({color: 'blue','background-color': 'gold'});
    }else if(table.rows[1].cells[i].innerText == "LOSE"){
      $(table.rows[1].cells[i]).css({color: 'white','background-color': 'red'});
    }else if(table.rows[1].cells[i].innerText == "DRAW"){
      $(table.rows[1].cells[i]).css({color: 'black','background-color': "transparent"});
    }else{}

    if(table.rows[2].cells[i].innerText == 1){
      $(table.rows[2].cells[i]).html('<img src="img/janken_gu.png" height="20">');
    }else if(table.rows[2].cells[i].innerText == 2){
      $(table.rows[2].cells[i]).html('<img src="img/janken_choki.png" height="20">');
    }else if(table.rows[2].cells[i].innerText == 3){
      $(table.rows[2].cells[i]).html('<img src="img/janken_pa.png" height="20">');
    }else{}

    if(table.rows[3].cells[i].innerText == 1){
      $(table.rows[3].cells[i]).html('<img src="img/cp_gu.png" height="20">');
    }else if(table.rows[3].cells[i].innerText == 2){
      $(table.rows[3].cells[i]).html('<img src="img/cp_choki.png" height="20">');
    }else if(table.rows[3].cells[i].innerText == 3){
      $(table.rows[3].cells[i]).html('<img src="img/cp_pa.png" height="20">');
    }else{}
  }

  //LocalStrageにデータを保存
  localStorage.setItem('count', count); //変数countをキーcountでlocalstrageに保存
  localStorage.setItem('wins_count', wins_count);
  localStorage.setItem('maxwins', maxwins);
  localStorage.setItem('g_results', JSON.stringify(g_results)); //JSON形式のデータを文字列に変換して保存
  localStorage.setItem('wins', JSON.stringify(wins));
  localStorage.setItem('beat', JSON.stringify(beat));
  console.log(localStorage.length); //確認
});

</script>
</body>
</html>
